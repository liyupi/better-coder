<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="https://tajs.qq.com/stats?sId=66552556" charset="UTF-8"></script>
    <title>music-fighter</title>
    <meta charset=utf-8>
    <meta name=description content="éŸ³ä¹æŒ‘æˆ˜è€…">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcdn.net/ajax/libs/animate.css/3.7.2/animate.min.css">
    <style type="text/css">
    * {
        -webkit-user-select: none;
        user-select: none;
        margin: 0;
        padding: 0;
    }

    html {
        font-size: 16px;
    }

    body {
        background: linear-gradient(-90deg, #29bdd9, #276ace);
        height: 100vh;
        padding: 10px;
        box-sizing: border-box;
        overflow: hidden;
    }

    #menu {
        display: flex;
        height: 100%;
        align-items: center;
        justify-content: space-around;
        text-align: center;
        color: white;
        font-size: 1rem;
    }

    .menu-btn {
        border: 1px solid white;
        border-radius: 50%;
        width: 75px;
        height: 75px;
        line-height: 75px;
    }

    .music-btn {
        border-radius: 50%;
        width: 5vh;
        padding: 1vh;
        font-size: 5vh;
        text-align: center;
        margin: 1.5vh;
    }

    #gameBoard,
    #gameControl {
        display: none;
    }

    #gameBoard {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }

    #gameControl {
        text-align: center;
        color: white;
        font-size: 1rem;
        padding: 30px;
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
    }

    #inputSeq {
        margin-bottom: 5px;
        border: 1px solid #fff;
        padding: 5px;
    }

    #inputSeq span {
        margin: 0 5px;
        font-size: 5vw;
    }

    #inputSeq .curr {
        font-size: 7vw;
        color: yellow;
    }

    #returnBtn {
        position: absolute;
        bottom: 5px;
        right: 5px;
    }
    </style>
</head>

<body>
    <!-- æ¸¸æˆé¢æ¿ -->
    <div id="gameBoard">
    </div>
    <!-- æ¸¸æˆæ§åˆ¶æ¿ -->
    <div id="gameControl">
        <div id="inputSeq"></div>
        <div id="returnBtn">è¿”å›</div>
    </div>
    <!-- æ¸¸æˆèœå• -->
    <div id="menu">
        <div id="easyBtn" class="menu-btn animated" data-btn-num="7">ç®€å•</div>
        <div id="mediumBtn" class="menu-btn animated" data-btn-num="14">ä¸­ç­‰</div>
        <div id="hardBtn" class="menu-btn animated" data-btn-num="21">å›°éš¾</div>
    </div>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.0/jquery.slim.min.js"></script>
    <script type="text/javascript">
    const MAX_GRID_NUM = 28; // æœ€å¤§ç½‘æ ¼æ•°
    let btnNum; // æ ¹æ®éš¾åº¦å†³å®šæ˜¾ç¤ºçš„æŒ‰é’®æ•°
    // è¦æ˜¾ç¤ºçš„æŒ‰é’®æ ·å¼
    const btnTexts = ['ğŸ”', 'ğŸ–', 'ğŸŸ', 'ğŸ‘', 'ğŸ¦†', 'ğŸ§', 'ğŸ­',
        'ğŸ‚', 'ğŸ¯', 'ğŸ°', 'ğŸ‰', 'ğŸ', 'ğŸ', 'ğŸµ',
        'ğŸ¶', 'ğŸ˜', 'ğŸŠ', 'ğŸ¦–', 'ğŸ¦Œ', 'ğŸ¿', 'ğŸ¨',
        'ğŸ»', 'ğŸ™', 'ğŸ¦‘', 'ğŸ¦ˆ', 'ğŸ¬', 'ğŸ‹', 'ğŸ—',
        'ğŸ¡', 'ğŸ¥', 'ğŸ«', 'ğŸ¦‡', 'ğŸ’©', 'ğŸ¦Š', 'ğŸ¦”',
        'ğŸ²', 'ğŸ¥š', 'ğŸ¦‚', 'ğŸ€', 'ğŸ¦', 'ğŸ¦'
    ];
    $(() => {
        $('.menu-btn').on('touchstart', function() {
            btnNum = $(this).attr('data-btn-num'); // ç®€å•
            $(this).addClass('swing');
            setTimeout(() => {
                startGame();
                $(this).removeClass('swing');
            }, 1000);
        });
        $('#returnBtn').click(function() {
            exitGame();
        });
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            $('#menu').hide();
            $('#gameBoard, #gameControl').show();
            // ç›®æ ‡è¾“å…¥
            const goalInput = [1, 2, 3, 5, 7, 4, 6, 7];
            let pos = 0;
            let output = `<span class="curr">${goalInput[0]}</span>`;
            for(let i = 1; i < goalInput.length; i++) {
                output += `<span>${goalInput[i]}</span>`;
            }
            $('#inputSeq').html(output);
            // å®é™…è¾“å…¥
            const myInput = [];
            const textNum = btnTexts.length;
            const showBtns = [];
            for (let i = 0; i < MAX_GRID_NUM; i++) {
                $('#gameBoard').append(`<div class="music-btn animated"></div>`);
            }
            for (let i = 0; i < btnNum; i++) {
                $('#gameBoard').append(`<audio class="music" src="./music${i + 1}.wav"></audio>`);
            }

            const selectedBtnTexts = [...btnTexts]; // è¢«é€‰ä¸­çš„æŒ‰é’®æ ·å¼
            const showGrids = Array.from(Array(MAX_GRID_NUM), (v, idx) => idx); // è¦å±•ç¤ºæŒ‰é’®çš„æ ¼å­
            // éšæœºæ’åº
            shuffle(selectedBtnTexts);
            shuffle(showGrids);
            const $allInputSpan = $('#inputSeq span');
            for (let i = 0; i < btnNum; i++) {
                const $musicBtn = $($('.music-btn')[showGrids[i]]);
                $musicBtn.html(selectedBtnTexts[i] + (i + 1)); 
                $musicBtn.on('touchstart', function() {
                    $('.music')[i].play();
                    $(this).addClass('tada');
                    setTimeout(() => {
                        $(this).removeClass('tada');
                    }, 1000);
                    myInput.push(i + 1);
                    // å¼¹å¯¹äº†
                    if (i + 1 === goalInput[pos]) {
                        $($allInputSpan[pos]).removeClass('curr');
                        $($allInputSpan[++pos]).addClass('curr');
                        if (pos >= goalInput.length) {
                            $('#inputSeq').html('æ­å–œé€šå…³ï¼Œè´¼ç‰›é€¼');
                        }
                    }
                })
            }
        }
        // é€€å‡ºæ¸¸æˆ
        function exitGame() {
            $('#gameBoard, #gameControl').hide();
            $('#menu').show();
            $('#gameBoard').empty();
            $('#inputSeq').empty();
        }
    });
    // éšæœºæ’åº
    function shuffle(arr) {
        let i = arr.length;
        while (i) {
            let j = Math.floor(Math.random() * i--);
            [arr[j], arr[i]] = [arr[i], arr[j]];
        }
    }
    </script>
</body>

</html>